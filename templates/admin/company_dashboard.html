{% extends "admin/frame.html" %}{% block admin %}
<h2 class="text-2xl font-extrabold mb-2">{{ company.name }}</h2>
<div class="text-sm text-base-muted mb-4">Company Code: <code>{{ company.code }}</code></div>
<div class="grid md:grid-cols-3 gap-4">
  <div class="bg-white rounded-xl p-4 border shadow-glass"><div class="text-base-muted">New</div><div class="text-3xl font-extrabold">{{ stats.new or 0 }}</div></div>
  <div class="bg-white rounded-xl p-4 border shadow-glass"><div class="text-base-muted">In Process</div><div class="text-3xl font-extrabold">{{ stats.inproc or 0 }}</div></div>
  <div class="bg-white rounded-xl p-4 border shadow-glass"><div class="text-base-muted">Closed</div><div class="text-3xl font-extrabold">{{ stats.closed or 0 }}</div></div>
</div>
<div class="grid lg:grid-cols-3 gap-4 mt-6">
  <div class="bg-white rounded-xl p-4 border shadow-glass"><canvas id="m"></canvas></div>
  <div class="bg-white rounded-xl p-4 border shadow-glass"><canvas id="c"></canvas></div>
  <div class="bg-white rounded-xl p-4 border shadow-glass">
    <h3 class="font-bold mb-2">Recent</h3>
    <table class="w-full text-sm">
      <tr class="text-left border-b"><th class="py-2">ID</th><th>Status</th><th>Created</th><th></th></tr>
      {% for r in recent %}
      <tr class="border-b">
        <td class="py-2">{{ r.id }}</td><td>{{ r.status }}</td><td>{{ r.created_at[:10] }}</td>
        <td><a class="text-brand-light" href="{{ url_for('admin_report_detail', rid=r.id) }}">Open</a></td>
      </tr>
      {% endfor %}
    </table>
  </div>
</div>
<script>
const colors=["#1e3a8a","#3b82f6","#64748b","#94a3b8","#cbd5e1","#e2e8f0","#1e293b","#0f172a"];
new Chart(document.getElementById('m'), {
  type:'line',
  data:{labels:{{ monthly|map(attribute='ym')|list|tojson }},
        datasets:[{label:'Reports',data:{{ monthly|map(attribute='cnt')|list|tojson }}, borderColor:colors[0]}]}
});
new Chart(document.getElementById('c'), {
  type:'bar',
  data:{labels:{{ bycat|map(attribute='category')|list|tojson }},
        datasets:[{label:'By Category',data:{{ bycat|map(attribute='cnt')|list|tojson }}, backgroundColor:colors}]}
});
</script>
{% endblock %}
